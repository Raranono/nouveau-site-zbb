---
const images = [
  "/images/banner.jpg",
  "/images/braderie.jpg",
  "/images/dimanche.jpg",
  "/images/lyon.jpg",
  "/images/rennes.jpg",
  "/images/toulon.jpg",
];
---
<!-- Script défilement -->

<script type="module" is:inline>
  // Récupération des images du carousel depuis l'attribut data-images de la DIV (le JSON.Stringify passait pas pour je ne sais quelle raison)
  const carousel = document.getElementById('carousel');
  const clientImages = JSON.parse(carousel.getAttribute('data-images'));


  let currentIndex = 0; // Index de l'image actuellement affichée
  const intervalTime = 5000;   // Intervalle de défilement automatique (5s)
  let intervalId;

  // Affichage image correspondant à l'index donné
  function showImage(index) {
    const imgs = document.querySelectorAll("[data-carousel-img]");
    const dots = document.querySelectorAll("[data-carousel-dot]");

    imgs.forEach((img, i) => {
      img.classList.toggle("opacity-100", i === index);
      img.classList.toggle("opacity-0", i !== index);
      img.classList.toggle("z-10", i === index);
      img.classList.toggle("z-0", i !== index);
    });

    dots.forEach((dot, i) => {
      dot.classList.toggle("bg-[#F4106F]", i === index);
      dot.classList.toggle("bg-[#F4106F]/50", i !== index);
    });
  }

  // Passage à l'image suivante
  function nextImage() {
    currentIndex = (currentIndex + 1) % clientImages.length;
    showImage(currentIndex);
  }

  // Passage à l'image précédente
  function prevImage() {
    currentIndex = (currentIndex - 1 + clientImages.length) % clientImages.length;
    showImage(currentIndex);
  }

  // Reset le timer de défilement automatique (quand interaction utilisateur)
  function resetTimer() {
    clearInterval(intervalId);
    intervalId = setInterval(nextImage, intervalTime);
  }

  // Exécuter le script quand page chargée
  window.addEventListener("DOMContentLoaded", () => {

    showImage(currentIndex); // Affichage image 0

    // Lancement défilement automatique
    intervalId = setInterval(nextImage, intervalTime);

    // Gestion de la navigation manuelle
    document.querySelectorAll("[data-carousel-dot]").forEach((dot, i) => {
      dot.addEventListener("click", () => {
        currentIndex = i;
        showImage(currentIndex);
        resetTimer(); // On remet le timer à zéro après un clic
      });
    });

    // Gestion du swipe sur mobile
    const container = document.getElementById("carousel");
    let startX = 0;
    let endX = 0;

    container.addEventListener("touchstart", (e) => {
      startX = e.touches[0].clientX;
    });

    container.addEventListener("touchend", (e) => {
      endX = e.changedTouches[0].clientX;
      if (startX - endX > 50) {
        nextImage();
        resetTimer();
      } else if (endX - startX > 50) {
        prevImage();
        resetTimer();
      }
    });
  });
</script>

<!-- Carousel -->
<div
  id="carousel"
  data-images={JSON.stringify(images)}
  class="relative w-full max-w-4xl mx-auto aspect-video overflow-hidden rounded-xl shadow-md bg-black"
>
  <!-- Images -->
  {images.map((src, i) => (
    <img
      src={src}
      alt={`Image ${i + 1}`}
      data-carousel-img
      class="absolute inset-0 w-full h-full object-cover transition-opacity duration-700 ease-in-out opacity-0 z-0"
    />
  ))}

  <!-- Points de navigation -->
  <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-3 z-20">
    {images.map((_, i) => (
      <button
        data-carousel-dot
        class="w-5 h-5 rounded-full bg-[#F4106F]/50 border border-white hover:bg-[#F4106F] transition-all duration-300 cursor-pointer"
        aria-label={`Image ${i + 1}`}
      ></button>
    ))}
  </div>
</div>
